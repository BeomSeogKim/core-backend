# Index
> 데이터의 검색 속도를 향상시키기 위해 사용하는 별도의 자료구조

## 핵심 원리
사전에서 특정 단어를 찾으려고 할 때, 두가지 방법이 존재한다.
1. 처음부터 끝까지 한장씩 넘기면서 모두 파악
2. 색인을 통해 원하는 단어를 찾아 페이지 번호를 확인하고 바로 이동

1의 경우 책이 두꺼워 질 수록 찾는 시간이 오래걸리는 반면, 2의 경우 책이 두꺼워져도 빠르게 찾을 수 있다는 장점이 존재한다.

## 장단점
| 구분           | 장점                                                               | 단점                                                          |
|--------------|------------------------------------------------------------------|-------------------------------------------------------------|
| 검색           | 조건에 맞는 데이터를 매우 빠르게 조회가 가능하다. </br>  (WHERE, JOIN, ORDER BY)에서 유리 | -                                                           |
| 변경 (C, U, D) | -                                                                | 데이터가 변경될 때 마다, 인덱스도 함께 수정해야 하여 성능저하 발생                      |
| 공간           | -                                                                | 인덱스를 위한 별도의 저장 공간(디스크)이 필요하다. </br> (보통 DB 크기의 10%정도 추가 차지) |


## Clustered Index, Non-Clustered Index

**Clustered Index**
- 물리적 정렬 : 데이터 자체가 인덱스 키 순서대로 디스크에 물리적으로 정렬되어 저장
- 유일성 : 무리적으로 정렬하는 방법은 단 하나뿐으로, 테이블당 1개만 존재할 수 있음
- 생성 기준 : 주로 Primary Key 설정 시 자동으로 생성됨 (Primary Key가 없으면 UNIQUE, NOT NULL 컬럼을, 그것도 없으면 내부적으로 숨겨진 ID 사용)
- 구조적 특징 (B+Tree) : 리프 노드에 실제 데이터 행 전체가 들어있다

**Non Clustered Index**
- 논리적 정렬 : 물리적인 데이터 순서는 그대로 두고, 별도의 장소에 인덱스 페이지를 만들어 정렬한다
- 다수성 : 테이블 당 여러개를 만들 수 있다
- 구조적 특징 (B+Tree) : 리프 노드에 실제 데이터가 없고, 데이터가 있는 곳의 주소를 가리키는 포인터가 존재한다

InnoDB에서의 Non Clustered Index
- 실제 데이터의 주소값이 아닌 PK의 값을 가진다
- 데이터 조회시 보조 인덱스를 타면 인덱스 트리를 2번 타야함 (보조 인덱스 검색 + PK 인덱스 검색)
- 대신, 데이터 이동 (Page Split)시 보조인덱스를 전부 수정하지 않아도 되는 이점이 존재한다.
    - 보조 인덱스가 물리적인 주소를 가르키는 경우 -> 해당 데이터를 가르키던 모든 보조 인덱스들을 찾아 새로운 주소로 업데이트 해야 함
    - 보조 인덱스가 PK를 가르키는 경우 -> 보조 인덱스들은 수정하지 않아도되며, PK 내부에서의 위치 정보만 갱신하면 된다.

## 커버링 인덱스
쿼리에서 요구하는 모든 컬럼이 인덱스에 모두 포함되어 있는 상태를 말한다.

커버링 인덱스가 아닌 경우 인덱스 조회시 PK를 기반으로 실제 테이블로 이동한다. (Random I/O 발생)

하지만 커버링 인덱스의 경우, 인덱스 자체에 필요한 값들이 모두 존재하기 때문에 Random I/O가 발생하지 않는 다는 장점이 존재한다.


## 인덱스 관련 명령어
```roomsql
-- 생성
CREATE INDEX {index_name} ON {table_name} ({column_name} .. );
-- 삭제
DROP INDEX {index_name} ON {table_name};
```